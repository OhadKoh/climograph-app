<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 拽专祝 砖</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fff;
            color: #333;
            margin: 0;
            padding: 10px;
            text-align: center;
        }
        
        /* 爪 拽 */
        body.clean-mode .editor-only { display: none !important; }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 10px;
        }

        /* 转专转 */
        .header-section input {
            font-size: 24px;
            padding: 5px;
            width: 80%;
            border: none;
            border-bottom: 2px solid #3498db;
            text-align: center;
            font-weight: bold;
            background: transparent;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        body.clean-mode .header-section input { border-bottom: none; pointer-events: none; }
        .subtitle { font-size: 16px; color: #555; font-weight: bold; }

        /* 专 专驻 - 驻拽住 爪 爪 */
        .charts-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .chart-box {
            flex: 1;
            min-width: 350px; /* 专  专祝 */
            max-width: 600px;
            position: relative;
        }
        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
            border: 1px solid #eee; /* 住专转 注 转 */
            border-radius: 8px;
            padding: 5px;
        }

        /* 转 */
        .tables-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .table-box { flex: 1; min-width: 350px; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            direction: ltr; 
        }
        th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
        th { background-color: #eee; font-weight: bold; }
        td input { width: 90%; border: none; background: transparent; text-align: center; }
        td input:focus { background-color: #e8f0fe; outline: none; }

        /* 驻转专 砖拽 */
        .controls-bar {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #eee;
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        
        button.action-btn {
            background-color: #2980b9;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button.action-btn.secondary { background-color: #95a5a6; }
        button.action-btn:hover { opacity: 0.9; }

        .axis-input input { width: 60px; padding: 5px; text-align: center; }

        /* 拽专 */
        .custom-legend {
            display: flex; justify-content: center; gap: 20px; margin-top: 10px; font-size: 14px;
        }
        .legend-item { display: flex; align-items: center; cursor: pointer; }
        .symbol-rain { width: 14px; height: 14px; background: rgba(54, 162, 235, 0.7); border: 1px solid blue; margin-left: 5px; }
        .symbol-temp-dot { width: 10px; height: 10px; background: #fff; border: 2px solid #e74c3c; border-radius: 50%; display: inline-block; margin-left: 5px;}
        .symbol-line { width: 20px; height: 3px; background: #e74c3c; display: flex; align-items: center; justify-content: center; margin-left: 5px;}

        /* 驻转专 注专 爪祝 */
        #editModeBtn {
            display: none; position: fixed; bottom: 10px; right: 10px;
            background: #eee; padding: 6px 12px; border-radius: 4px; cursor: pointer; border: 1px solid #ccc;
        }
    </style>
</head>
<body>

<div class="main-container">
    
    <div class="controls-bar editor-only">
        <div>
            <label><input type="checkbox" id="compareModeCheck" onchange="toggleCompareMode()"> <strong>爪 砖 (砖 拽转)</strong></label>
        </div>
        <div class="axis-input">
            <label> 拽住 爪专 砖 (抓 拽注): </label>
            <input type="number" id="maxRainInput" placeholder="'" onchange="updateCharts()">
        </div>
        <button class="action-btn" onclick="generateAndSave()"> 砖专 爪专 拽砖专</button>
        <div style="font-size: 12px; color: #666;">(转 拽 转 拽住 注 Ctrl+V 注 砖 专)</div>
    </div>

    <div class="charts-row">
        <div class="chart-box">
            <div class="header-section">
                <input type="text" id="name1" placeholder="砖 拽 专砖" oninput="updateTitles()">
                <div class="subtitle" id="sub1">爪注 砖拽注: 0 "</div>
            </div>
            <div class="chart-wrapper">
                <canvas id="chart1"></canvas>
            </div>
        </div>

        <div class="chart-box" id="box2" style="display:none;">
            <div class="header-section">
                <input type="text" id="name2" placeholder="砖 拽 砖" oninput="updateTitles()">
                <div class="subtitle" id="sub2">爪注 砖拽注: 0 "</div>
            </div>
            <div class="chart-wrapper">
                <canvas id="chart2"></canvas>
            </div>
        </div>
    </div>

    <div class="custom-legend">
        <div class="legend-item">
            <div class="symbol-rain"></div><span>砖拽注 (")</span>
        </div>
        <div class="legend-item">
            <div class="symbol-line"><div class="symbol-temp-dot"></div></div><span>驻专专 (C掳)</span>
        </div>
    </div>

    <div class="tables-container editor-only">
        <div class="table-box">
            <h3 style="margin:5px 0;">转 拽 专砖</h3>
            <table id="table1">
                </table>
        </div>

        <div class="table-box" id="tableBox2" style="display:none;">
            <h3 style="margin:5px 0;">转 拽 砖</h3>
            <table id="table2">
                </table>
        </div>
    </div>

</div>

<div id="editModeBtn" onclick="toggleEditMode()">锔 注专转 转</div>

<script>
    let chartInstance1 = null;
    let chartInstance2 = null;
    const months = ['', '驻专', '专抓', '驻专', '', '', '', '', '住驻', '拽', '', '爪'];

    // 专专转 
    const defaultData = {
        name: "转 ",
        rain: [130, 110, 70, 20, 5, 0, 0, 0, 1, 25, 80, 110],
        temp: [12, 13, 15, 19, 23, 26, 28, 29, 27, 24, 18, 14]
    };

    function initTable(tableId, suffix) {
        const table = document.getElementById(tableId);
        let headerHTML = '<thead><tr><th>砖</th>';
        months.forEach(m => headerHTML += `<th>${m}</th>`);
        headerHTML += '</tr></thead><tbody>';

        // 砖专转 砖
        headerHTML += `<tr><td style="background:#eef; font-weight:bold;">砖</td>`;
        for(let i=0; i<12; i++) {
            headerHTML += `<td><input type="number" class="rain${suffix}" onpaste="handlePaste(event, 'rain${suffix}', ${i})" oninput="updateCharts()"></td>`;
        }
        headerHTML += '</tr>';

        // 砖专转 驻专专
        headerHTML += `<tr><td style="background:#ffe; font-weight:bold;">驻'</td>`;
        for(let i=0; i<12; i++) {
            headerHTML += `<td><input type="number" class="temp${suffix}" onpaste="handlePaste(event, 'temp${suffix}', ${i})" oninput="updateCharts()"></td>`;
        }
        headerHTML += '</tr></tbody>';
        table.innerHTML = headerHTML;
    }

    // 拽 拽住
    function handlePaste(e, className, startIndex) {
        e.preventDefault();
        const clipboardData = e.clipboardData || window.clipboardData;
        const pastedData = clipboardData.getData('Text');
        const values = pastedData.split(/[\t\s,]+/).filter(v => v.trim() !== '');
        const inputs = document.querySelectorAll('.' + className);
        values.forEach((val, i) => {
            const index = startIndex + i;
            if (index < inputs.length && !isNaN(parseFloat(val))) {
                inputs[index].value = parseFloat(val);
            }
        });
        updateCharts();
    }

    function toggleCompareMode() {
        const isCompare = document.getElementById('compareModeCheck').checked;
        document.getElementById('box2').style.display = isCompare ? 'block' : 'none';
        document.getElementById('tableBox2').style.display = isCompare ? 'block' : 'none';
        updateCharts(); // 专注  转 
    }

    function getInputs(suffix) {
        const rainInputs = document.querySelectorAll('.rain' + suffix);
        const tempInputs = document.querySelectorAll('.temp' + suffix);
        return {
            rain: Array.from(rainInputs).map(i => parseFloat(i.value) || 0),
            temp: Array.from(tempInputs).map(i => parseFloat(i.value) || 0)
        };
    }

    function setInputs(suffix, rainData, tempData) {
        const rainInputs = document.querySelectorAll('.rain' + suffix);
        const tempInputs = document.querySelectorAll('.temp' + suffix);
        rainInputs.forEach((inp, i) => { if(rainData[i] !== undefined) inp.value = rainData[i]; });
        tempInputs.forEach((inp, i) => { if(tempData[i] !== undefined) inp.value = tempData[i]; });
    }

    function createChart(ctxId, rainData, tempData, yMax) {
        const ctx = document.getElementById(ctxId).getContext('2d');
        
        return new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    {
                        label: '砖拽注',
                        data: rainData,
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'blue',
                        borderWidth: 1,
                        yAxisID: 'y',
                        order: 2,
                        barPercentage: 0.6
                    },
                    {
                        label: '驻专专',
                        data: tempData,
                        type: 'line',
                        borderColor: '#e74c3c',
                        backgroundColor: '#e74c3c',
                        borderWidth: 3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#e74c3c',
                        pointRadius: 4,
                        tension: 0.2,
                        yAxisID: 'y1',
                        order: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false }, title: { display: false } },
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        max: yMax,
                        beginAtZero: true,
                        title: { display: true, text: '"' }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        grid: { drawOnChartArea: false },
                        title: { display: true, text: 'C掳' }
                    }
                }
            }
        });
    }

    function updateCharts() {
        const data1 = getInputs('1');
        const data2 = getInputs('2');
        
        // 注 转专转 砖
        const sum1 = data1.rain.reduce((a,b)=>a+b, 0);
        const sum2 = data2.rain.reduce((a,b)=>a+b, 0);
        document.getElementById('sub1').innerText = `爪注 砖拽注: ${Math.round(sum1)} "`;
        document.getElementById('sub2').innerText = `爪注 砖拽注: ${Math.round(sum2)} "`;

        // 拽住 爪专
        const userMax = document.getElementById('maxRainInput').value;
        const yMax = userMax ? parseFloat(userMax) : null;

        if (chartInstance1) chartInstance1.destroy();
        chartInstance1 = createChart('chart1', data1.rain, data1.temp, yMax);

        if (document.getElementById('compareModeCheck').checked) {
            if (chartInstance2) chartInstance2.destroy();
            chartInstance2 = createChart('chart2', data2.rain, data2.temp, yMax);
        }
    }

    function updateTitles() {
        // 转专转 转注转  转 专 -Input 注爪
    }

    function generateAndSave() {
        const name1 = document.getElementById('name1').value;
        const data1 = getInputs('1');
        
        const isCompare = document.getElementById('compareModeCheck').checked;
        const name2 = document.getElementById('name2').value;
        const data2 = getInputs('2');
        
        const ymax = document.getElementById('maxRainInput').value;

        let newUrl = `${window.location.pathname}?view=clean&n1=${encodeURIComponent(name1)}&r1=${data1.rain}&t1=${data1.temp}`;
        
        if (isCompare) {
            newUrl += `&compare=1&n2=${encodeURIComponent(name2)}&r2=${data2.rain}&t2=${data2.temp}`;
        }
        if (ymax) newUrl += `&ymax=${ymax}`;

        window.history.pushState({path: newUrl}, '', newUrl);
        
        // 住 爪 拽
        document.body.classList.add('clean-mode');
        document.getElementById('editModeBtn').style.display = 'block';
    }

    function toggleEditMode() {
        document.body.classList.remove('clean-mode');
        document.getElementById('editModeBtn').style.display = 'none';
        const params = new URLSearchParams(window.location.search);
        params.delete('view');
        const newUrl = `${window.location.pathname}?${params.toString()}`;
        window.history.pushState({path: newUrl}, '', newUrl);
    }

    // 注
    window.onload = function() {
        initTable('table1', '1');
        initTable('table2', '2');

        const params = new URLSearchParams(window.location.search);
        
        // 注转 砖 1 转 1
        if (params.has('n1')) {
            document.getElementById('name1').value = decodeURIComponent(params.get('n1'));
            setInputs('1', params.get('r1').split(',').map(Number), params.get('t1').split(',').map(Number));
        } else {
            setInputs('1', defaultData.rain, defaultData.temp);
            document.getElementById('name1').value = defaultData.name;
        }

        // 拽转 砖
        if (params.get('compare') === '1') {
            document.getElementById('compareModeCheck').checked = true;
            document.getElementById('name2').value = decodeURIComponent(params.get('n2'));
            setInputs('2', params.get('r2').split(',').map(Number), params.get('t2').split(',').map(Number));
            toggleCompareMode();
        }

        if (params.has('ymax')) {
            document.getElementById('maxRainInput').value = params.get('ymax');
        }

        if (params.get('view') === 'clean') {
            document.body.classList.add('clean-mode');
            document.getElementById('editModeBtn').style.display = 'block';
        }
        
        updateCharts();
    };
</script>

</body>
</html>
